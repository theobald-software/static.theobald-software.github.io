!function(){(window.theobald||(window.theobald={})).moduleName="theobald.ecs.micro",function(){var e=window.theobald||(window.theobald={});!function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function n(e,n){if(t(e))for(var r=0;r<e.length;r++)n(e[r]);else n(e)}function r(e){var o="pending",i=[],a=[],c=[],s=null,u={done:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"resolved"===o&&n[r].apply(this,s),i.push(n[r]);else"resolved"===o&&arguments[e].apply(this,s),i.push(arguments[e]);return this},fail:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"rejected"===o&&n[r].apply(this,s),a.push(n[r]);else"rejected"===o&&arguments[e].apply(this,s),a.push(arguments[e]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var e=0;e<arguments.length;e++)if(arguments[e])if(t(arguments[e]))for(var n=arguments[e],r=0;r<n.length;r++)"pending"===o&&c.push(n[r]);else"pending"===o&&c.push(arguments[e]);return this},then:function(){arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2])},promise:function(e){if(null==e)return u;for(var t in u)e[t]=u[t];return e},state:function(){return o},debug:function(){console.log("[debug]",i,a,o)},isRejected:function(){return"rejected"===o},isResolved:function(){return"resolved"===o},pipe:function(e,t,o){return r(function(r){n(e,function(e){"function"==typeof e?l.done(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(r.resolve,r.reject,r.notify):r.resolve(t)}):l.done(r.resolve)}),n(t,function(e){"function"==typeof e?l.fail(function(){var t=e.apply(this,arguments);t&&"function"==typeof t?t.promise().then(r.resolve,r.reject,r.notify):r.reject(t)}):l.fail(r.reject)})}).promise()}},l={resolveWith:function(e){if("pending"===o){o="resolved";for(var t=s=arguments.length>1?arguments[1]:[],n=0;n<i.length;n++)i[n].apply(e,t)}return this},rejectWith:function(e){if("pending"===o){o="rejected";for(var t=s=arguments.length>1?arguments[1]:[],n=0;n<a.length;n++)a[n].apply(e,t)}return this},notifyWith:function(e){if("pending"===o)for(var t=s=arguments.length>1?arguments[1]:[],n=0;n<c.length;n++)c[n].apply(e,t);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},d=u.promise(l);return e&&e.apply(d,[d]),d}r.when=function(){if(arguments.length<2){var e=arguments.length?arguments[0]:void 0;return e&&"function"==typeof e.isResolved&&"function"==typeof e.isRejected?e.promise():r().resolve(e).promise()}return function(e){for(var t=r(),n=e.length,o=0,i=new Array(n),a=0;a<e.length;a++)!function(r){var a=null;e[r].done?e[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++o==n&&t.resolve.apply(t,i)}).fail(function(){t.reject(arguments)}):(a=e[r],e[r]=new Deferred,e[r].done(function(){i[r]=arguments.length<2?arguments[0]:arguments,++o==n&&t.resolve.apply(t,i)}).fail(function(){t.reject(arguments)}).resolve(a))}(a);return t.promise()}(arguments)},e.Deferred=r}(e),e.newDeferred=function(){return new e.Deferred};var t=e.deferreds||(e.deferreds={});e.getDeferred=function(n){return t[n]||(t[n]=e.newDeferred())};var n=e.getDeferred("Ecs");e.readyDeferred=e._readyDeferred=n.promise(),e.ready=e._ready=function(e){return n.done(e)}}();var e,t,n;!function(r){function o(e,t){return b.call(e,t)}function i(e,t){var n,r,o,i,a,c,s,u,l,d,f,p=t&&t.split("/"),h=y.map,g=h&&h["*"]||{};if(e){for(a=(e=e.split("/")).length-1,y.nodeIdCompat&&E.test(e[a])&&(e[a]=e[a].replace(E,"")),"."===e[0].charAt(0)&&p&&(e=p.slice(0,p.length-1).concat(e)),l=0;l<e.length;l++)if("."===(f=e[l]))e.splice(l,1),l-=1;else if(".."===f){if(0===l||1===l&&".."===e[2]||".."===e[l-1])continue;l>0&&(e.splice(l-1,2),l-=2)}e=e.join("/")}if((p||g)&&h){for(l=(n=e.split("/")).length;l>0;l-=1){if(r=n.slice(0,l).join("/"),p)for(d=p.length;d>0;d-=1)if((o=h[p.slice(0,d).join("/")])&&(o=o[r])){i=o,c=l;break}if(i)break;!s&&g&&g[r]&&(s=g[r],u=l)}!i&&s&&(i=s,c=u),i&&(n.splice(0,c,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=w.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),h.apply(r,n.concat([e,t]))}}function c(e){return function(t){return i(t,e)}}function s(e){return function(t){S[e]=t}}function u(e){if(o(v,e)){var t=v[e];delete v[e],x[e]=!0,p.apply(r,t)}if(!o(S,e)&&!o(x,e))throw new Error("No "+e);return S[e]}function l(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return e?l(e):[]}function f(e){return function(){return y&&y.config&&y.config[e]||{}}}var p,h,g,m,S={},v={},y={},x={},b=Object.prototype.hasOwnProperty,w=[].slice,E=/\.js$/;g=function(e,t){var n,r=l(e),o=r[0],a=t[1];return e=r[1],o&&(n=u(o=i(o,a))),o?e=n&&n.normalize?n.normalize(e,c(a)):i(e,a):(o=(r=l(e=i(e,a)))[0],e=r[1],o&&(n=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:n}},m={require:function(e){return a(e)},exports:function(e){var t=S[e];return void 0!==t?t:S[e]={}},module:function(e){return{id:e,uri:"",exports:S[e],config:f(e)}}},p=function(e,t,n,i){var c,l,f,p,h,y,b,w=[],E=typeof n;if(i=i||e,y=d(i),"undefined"===E||"function"===E){for(t=!t.length&&n.length?["require","exports","module"]:t,h=0;h<t.length;h+=1)if(p=g(t[h],y),"require"===(l=p.f))w[h]=m.require(e);else if("exports"===l)w[h]=m.exports(e),b=!0;else if("module"===l)c=w[h]=m.module(e);else if(o(S,l)||o(v,l)||o(x,l))w[h]=u(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,a(i,!0),s(l),{}),w[h]=S[l]}f=n?n.apply(S[e],w):void 0,e&&(c&&c.exports!==r&&c.exports!==S[e]?S[e]=c.exports:f===r&&b||(S[e]=f))}else e&&(S[e]=n)},e=t=h=function(e,t,n,o,i){if("string"==typeof e)return m[e]?m[e](t):u(g(e,d(t)).f);if(!e.splice){if((y=e).deps&&h(y.deps,y.callback),!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},"function"==typeof n&&(n=o,o=i),o?p(r,e,t,n):setTimeout(function(){p(r,e,t,n)},4),h},h.config=function(e){return h(e)},e._defined=S,(n=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),o(S,e)||o(v,e)||(v[e]=[e,t,n])}).amd={jQuery:!0}}(),n("../lib/almond/almond.js",function(){}),n("theobald.ajax",[],function(){function e(e,t,n){return!0}function t(t,n,r,o){if(t.global)return e(n||x,r,o)}function n(e){e.global&&0==F.active++&&t(e,null,"ajaxStart")}function r(e){e.global&&!--F.active&&t(e,null,"ajaxStop")}function o(e,n){var r=n.context;if(!1===n.beforeSend.call(r,e,n)||!1===t(n,r,"ajaxBeforeSend",[e,n]))return!1;t(n,r,"ajaxSend",[e,n])}function i(e,n,r){var o=r.context;r.success.call(o,e,"success",n),t(r,o,"ajaxSuccess",[n,r,e]),c("success",n,r)}function a(e,n,r,o){var i=o.context;o.error.call(i,r,n,e),t(o,i,"ajaxError",[r,o,e]),c(n,r,o)}function c(e,n,o){var i=o.context;o.complete.call(i,n,e),t(o,i,"ajaxComplete",[n,o]),r(o)}function s(){}function u(e){return e&&(e==C?"html":e==E?"json":b.test(e)?"script":w.test(e)&&"xml")||"text"}function l(e,t){return(e+"&"+t).replace(/[&?]{1,2}/,"?")}function d(e){"object"===v(e.data)&&(e.data=p(e.data)),!e.data||e.type&&"GET"!=e.type.toUpperCase()||(e.url=l(e.url,e.data))}function f(e,t,n,r){var o="array"===v(t);for(var i in t){var a=t[i];r&&(i=n?r:r+"["+(o?"":i)+"]"),!r&&o?e.add(a.name,a.value):(n?"array"===v(a):"object"===v(a))?f(e,a,n,i):e.add(i,a)}}function p(e,t){var n=[];return n.add=function(e,t){this.push(_(e)+"="+_(t))},f(n,e,t),n.join("&").replace("%20","+")}function h(e){return Array.prototype.slice.call(arguments,1).forEach(function(t){for(g in t)void 0!==t[g]&&(e[g]=t[g])}),e}var g,m,S=window.theobald||(window.theobald={}),v=function(e){return typeof e},y=0,x=window.document,b=/^(?:text|application)\/javascript/i,w=/^(?:text|application)\/xml/i,E="application/json",C="text/html",j=/^\s*$/,F=function(e){var t=h({},e||{});for(g in F.settings)void 0===t[g]&&(t[g]=F.settings[g]);n(t),t.crossDomain||(t.crossDomain=/^([\w-]+:)?\/\/([^\/]+)/.test(t.url)&&RegExp.$2!=window.location.host);var r=t.dataType,c=/=\?/.test(t.url);if("jsonp"==r||c)return c||(t.url=l(t.url,"callback=?")),F.JSONP(t);t.url||(t.url=window.location.toString()),d(t);var f,p=t.accepts[r],S={},v=/^([\w-]+:)\/\//.test(t.url)?RegExp.$1:window.location.protocol,y=F.settings.xhr();t.crossDomain||(S["X-Requested-With"]="XMLHttpRequest"),p&&(S.Accept=p,p.indexOf(",")>-1&&(p=p.split(",",2)[0]),y.overrideMimeType&&y.overrideMimeType(p)),(t.contentType||t.data&&"GET"!=t.type.toUpperCase())&&(S["Content-Type"]=t.contentType||"application/x-www-form-urlencoded"),t.headers=h(S,t.headers||{}),y.onreadystatechange=function(){if(4==y.readyState){clearTimeout(f);var e,n=!1;if(y.status>=200&&y.status<300||304==y.status||0==y.status&&"file:"==v){r=r||u(y.getResponseHeader("content-type")),e=y.responseText;try{"script"==r?(0,eval)(e):"xml"==r?e=y.responseXML:"json"==r&&(e=j.test(e)?null:JSON.parse(e))}catch(e){n=e}n?a(n,"parsererror",y,t):i(e,y,t)}else a(null,"error",y,t)}};var x=!("async"in t)||t.async;y.open(t.type,t.url,x);for(m in t.headers)y.setRequestHeader(m,t.headers[m]);return!1===o(y,t)?(y.abort(),!1):(t.timeout>0&&(f=setTimeout(function(){y.onreadystatechange=s,y.abort(),a(null,"timeout",y,t)},t.timeout)),y.send(t.data?t.data:null),y)};F.active=0,F.JSONP=function(e){if(!("type"in e))return F(e);var t,n="jsonp"+ ++y,r=x.createElement("script"),o={abort:function(){n in window&&(window[n]=s),c("abort",o,e)}},a=x.getElementsByTagName("head")[0]||x.documentElement;return e.error&&(r.onerror=function(){o.abort(),e.error()}),window[n]=function(r){clearTimeout(t),delete window[n],i(r,o,e)},d(e),r.src=e.url.replace(/=\?/,"="+n),a.insertBefore(r,a.firstChild),e.timeout>0&&(t=setTimeout(function(){o.abort(),c("timeout",o,e)},e.timeout)),o},F.settings={type:"GET",beforeSend:s,success:s,error:s,complete:s,context:null,global:!0,xhr:function(){return new window.XMLHttpRequest},accepts:{script:"text/javascript, application/javascript",json:E,xml:"application/xml, text/xml",html:C,text:"text/plain"},crossDomain:!1,timeout:0},F.get=function(e,t){return F({url:e,success:t})},F.post=function(e,t,n,r){return"function"===v(t)&&(r=r||n,n=t,t=null),F({type:"POST",url:e,data:t,success:n,dataType:r})},F.getJSON=function(e,t){return F({url:e,success:t,dataType:"json"})};var _=encodeURIComponent;return S.ajax=F,F}),n("theobald.util",[],function(){var e=window.theobald||(window.theobald={}),t=e.util||(e.util={});return t.noop=function(){},t._extendInternal=function(e,t,n){var r,o={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},i=e,a=i;if(!i)return a;var c,s=arguments,u=0,l="number"==typeof n?2:s.length;for(l>2&&"function"==typeof s[l-1]&&(c=s[--l]);++u<l;)if((i=s[u])&&o[typeof i])for(var d=-1,f=o[typeof i]&&Object.keys(i),p=f?f.length:0;++d<p;){var h;r=f[d],c?void 0!==(h=c(a[r],i[r],r,a,i))&&(a[r]=h):a[r]=i[r]}return a},t._extend=t._deepExtend=function(){var e=[].slice.call(arguments);return e.push(t._extendFilterDeep),t._extendInternal.apply(this,e)},t._extendSkipEmptyStrings=function(){var e=[].slice.call(arguments);return e.push(t._extendFilterDeepSkipEmptyStrings),t._extendInternal.apply(this,e)},t._merge=function(){return Array.prototype.slice.call(arguments,1).forEach(function(e){if(e)for(var n in e)null!==e[n]&&e[n].constructor===Object?obj[n]&&obj[n].constructor!==Object?obj[n]=e[n]:(obj[n]=obj[n]||{},t._merge(obj[n],e[n])):obj[n]=e[n]}),obj},t._extendFilterDeep=function(e,n){return"object"==typeof e&&"object"==typeof n?t._extendInternal(e,n,t._extendFilterDeep):void 0!==n?n:void 0!==e?e:void 0},t._extendFilterDeepSkipEmptyStrings=function(e,n){return"object"==typeof e&&"object"==typeof n?t._extendInternal(e,n,t._extendFilterDeepSkipEmptyStrings):void 0!==n&&(""!==n||void 0===e&&null===e)?n:e},t.clone=function(e){return JSON.parse(JSON.stringify(e))},t.format=function(e,t){return t="object"==typeof t?t:Array.prototype.slice.call(arguments,1),e.replace(/\{\{|\}\}|\{(\w+)\}/g,function(e,n){return"{{"==e?"{":"}}"==e?"}":t[n]})},t.trim=function(e,n){return t.ltrim(t.rtrim(e,n),n)},t.ltrim=function(e,t){return t=t||"\\s",e.replace(new RegExp("^["+t+"]+","g"),"")},t.rtrim=function(e,t){return t=t||"\\s",e.replace(new RegExp("["+t+"]+$","g"),"")},t.padLeft=function(e,t,n){var r=e+"",o=t-r.length+1;return o>0?Array(o).join(n||" ")+r:r},t.padRight=function(e,t,n){var r=e+"";return r+Array(t-r.length+1).join(n||" ")},t.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},t}),n("theobald.ecs",["theobald.ajax","theobald.util"],function(e,t){var n,r=window.theobald||(window.theobald={}),o=r.deferreds||(r.deferreds={}),i="Ecs",a=i.toLowerCase(),c={colonSpace:": ",empty:"",htmlLineBreak:"<br/>",literalLineBreak:"\n",literalNewLineReturn:"\r\n",slash:"/",space:" ",charZero:"0"},s=c.empty,u={sponline:!1},l=e,d=t,f=r.newDeferred;if(r[a])return r[a];r[i]=function(){};var p=r[i].fn=r[i].prototype;p.className=i,p.version="5.7.0",p.timeStamp="Wed Apr 24 2019 18:42:28 GMT+0200 (Central European Summer Time)",p.copyright="Theobald Software GmbH.",p.defaultConfig={behavior:{requestTimeout:6e4},connection:{ecs:{authenticate:s,core:s,coreApiKey:s,instance:s,queryLanguage:"EN",serviceApplication:s,useSharepointSettings:s,url:"/_vti_bin/ERPConnectServiceRest.svc/"}},configVersion:20},p.session={},p.localizableStrings={en:{ecsError:"There might be a problem with ECS",errors:{abort:"Request aborted.",ecsErrorExecuteFunction:"ECS tried to execute function but failed, please check connection integrity",ecsConnectionTestFailed:"Service connection test FAILED.",ecsSapConnectionTestFail:"SAP Connection FAILED.",genericSap:"Unknown SAP problem.",genericErrorTitle:"Something went wrong.",parametersName:"Function name not specified",parsererror:"Requested JSON parse failed.",sapErrorExecuteFunction:"Function execution failed with errors, please check ExecuteFunction Query",sapErrorCreateFunction:"Function's metadata could not be read, please check CreateFunction Query",sharepointApiKey:"Api-Key could not be read (SharePoint)",timeout:"Operation could not be completed. Slow connection or internal error.",urlNotProvided:"For ECSCore queries within SPOnline Url must be specified",unknownError:"Other error",wrongEcsLibrary:"If you intented to use tEcs with Sharepoint, please switch to theobald.ecs: https://static.theobald-software.com/theobald.ecs"},info:{ecsConnectionTested:"Service successfully tested.",ecscoreMode:"SPOnline detected, entering ECSCore mode.",ecsSapConnectionTested:"Connection with SAP system successfully tested.",aborted:"Process Aborted",credentialAdded:"User credentials added.",credentialDeleted:"User credentials removed.",credentialChecked:"User credentials are correct.",credentialCheckedFail:"User credentials are incorrect.",credentialFail:"Credentials could not be processed."},warnings:{scopeWithoutID:"tecs.scope: no scope ID",scopeNotDefined:"tecs.scope: closing scope without ID",xqlNotString:"tecs.executexql: query not a string.",chainNoQueue:"tecs.chain: no function queue."},sapError:"SAP Error",sapInfo:"SAP Information",sapValidation:"SAP Validation:\n{0}",sapWarning:"SAP Warning",unexpectedParameterFormat:"Possibly not supported data-type: '{0}' of structure at index {1}"},de:{ecsError:"Ein Problem mit ECS ist aufgetreten",errors:{abort:"Anfrage abgebrochen.",connectionOrRequest:"Verbindungsproblem oder inkorrekte Anfrage",ecsErrorExecuteFunction:"Die Funktion konnte von ECS nicht gesteuert werden, überprüfen Sie bitte die Signaturen aller Parameter (ExecuteFunction Query)",ecsConnectionTestFailed:"Der Verbindung zum Dienst ist fehlgeschlagen.",ecsSapConnectionTestFail:"Die SAP-Verbindung ist fehlgeschlagen.",genericSap:"Unbekannter SAP-Fehler.",genericErrorTitle:"Fehler",parametersName:"Bitte überprüfen Sie den Funktionsnamen",parsererror:"JSON-Parser Fehler.",sapErrorExecuteFunction:"Die SAP-Funktion wurde nicht ordnungsmäßig ausgeführt (ExecuteFunction Query)",sapErrorCreateFunction:"Die Metadaten der SAP-Funktion konnten nicht gelesen werden (CreateFunction Query)",sharepointApiKey:"Der Api-Key konnte nicht gelesen werden (SharePoint)",timeout:"Die Operation meldete sich nicht zurück. Langsame Verbindung oder ein interner Fehler.",urlNotProvided:"Geben Sie bitte ECSCore Endpoint ein (Url)",unknownError:"Unbekannter Fehler",wrongEcsLibrary:"Die erweiterte tEcs Version für SharePoint befindet sich unter: https://static.theobald-software.com/theobald.ecs"},info:{ecsConnectionTested:"Der Dienst wurde erfolgreich getestet.",ecscoreMode:"SPOnline: wechsele in den ECSCore-Modus.",ecsSapConnectionTested:"Die Verbindung zum SAP-System ist OK.",aborted:"Prozess wurde unterbrochen.",credentialAdded:"Benutzer wurde hinzugefügt.",credentialDeleted:"Benutzer wurde entfernt.",credentialChecked:"Benutzerdaten wurden überprüft.",credentialCheckedFail:"Benutzerdaten sind falsch.",credentialFail:"SecureStore Fehler."},sapValidation:"SAP Validierung:\n{0}",sapWarning:"SAP Warnung",sapInfo:"SAP Information",sapError:"SAP Fehler",unexpectedParameterFormat:"Der Typ von '{0}' auf Index {1} in der Struktur möglicherweise nicht unterstützt"}},p.constants={actions:{BeginConnectionScope:"BeginConnectionScope",CreateFunction:"CreateFunction",EndConnectionScope:"EndConnectionScope",ExecuteFunction:"ExecuteFunction",ExecuteXQL:"ExecuteXQL",TestConnection:"Test",TestSAPConnection:"TestSAPConnection",AddCredentialToSecureStore:"AddCredentialToSecureStore",DeleteCredentialFromSecureStore:"DeleteCredentialFromSecureStore",CheckCredentialInSecureStore:"CheckCredentialInSecureStore",GetServiceApplicationInfoList:"GetServiceApplicationInfoList",CreateExecuteFunction:"CreateExecuteFunction",ExecuteInScope:"ExecuteInScope"},http:{contentTypeJson:"application/json; charset=utf-8"},messages:{tecsDone:"tecs.{0}.done",tecsFail:"ecs.{0}.fail",ecsDone:"ecs.{0}.done",ecsFail:"ecs.{0}.fail",sapDone:"sap.{0}.done",sapFail:"sap.{0}.fail",xhrDone:"xhr.{0}.done",xhrFail:"xhr.{0}.fail"},parameterDirection:{EXPORT:"export",IMPORT:"import",TABLES:"tables",CHANGINGS:"changings"},responses:{EndConnectionScopeOk:"OK"},sap:{functions:{BapiTransactionCommit:"BAPI_TRANSACTION_COMMIT",CrystalGetLogonLanguage:"/CRYSTAL/GET_LOGON_LANGUAGE"},errorCode:"E",warningCode:"W",dateFormat:"yyyyMMdd"},xql:{parameters:{language:"SPRAS = {0} ",languageDefault:"EN"},SELECT:"SELECT {0} ",select:function(e){return"SELECT "+e+" "},from:function(e){return"FROM "+e+" "},where:function(e){return"WHERE "+e+" "},and:function(e){return"AND "+e+" "},or:function(e){return"OR "+e+" "},top10:"TOP 10 ",FROM:"FROM {0} ",WHERE:"WHERE {0} ",LIKE:"LIKE {0}",like1parameter:"{0} LIKE '{{{0}}}% '",like2parameters:"({0} LIKE '{{{0}}}%' OR {1} LIKE '{{{0}}}%') ",OR:"OR {0} ",AND:"AND {0} ",nextParameter:"{0}, ",lastParameter:"{0} "}},n=p.constants.actions,p.stringify=function(e,t){var n;if(e.documentElement)return s;try{n=JSON.stringify(e,void 0,t?c.htmlLineBreak:2)}catch(e){n=s}return n},p.ajax=l,p.util=d,p._extendInternal=d._extendInternal,p._extend=p._deepExtend=d._extend,p._extendSkipEmptyStrings=d._extendSkipEmptyStrings,p._merge=d._merge,p._extendFilterDeep=d._extendFilterDeep,p._extendFilterDeepSkipEmptyStrings=d._extendFilterDeepSkipEmptyStrings,p.format=d.format,p.insureSlash=function(e){return e+(e.slice(-1)===c.slash?c.empty:c.slash)},p.getUrlWithProtocol=function(e){var t=e;return 0!==e.indexOf("http")&&("/"===e[0]&&("/"===e[1]&&(this.warn("connection.ecs.url starts with two slashes"),t=t.substr(1)),t=t.substr(1)),t="https://"+t),t},p.getTimeout=function(e){return parseInt(e)&&e||parseInt(r.ecs.config.behavior.requestTimeout)&&r.ecs.config.behavior.requestTimeout||!0===r.ecs.config.behavior.requestTimeout&&6e4},p.getWrapString=function(e,t){t||(t={});var n=t.html?c.htmlLineBreak:c.literalLineBreak;return this.format("{0}:{1}",e,n)},p.getEcsAuthorization=function(e){if(!e)return this.error("apikey not specified"),c.empty;var t;return"string"==typeof e&&(t="Apikey "+btoa(e)),t},p.abortRunningRequest=function(e){for(var t=e;t&&!t.abort;)t=t._deferred;t&&t.abort&&t.abort()},p.executeAjaxRequest=function(e){function t(){var e=o(),t=f();return e.error?l.fail(_).reject(e.error):(e.error=function(){return t.reject.apply(t,arguments)},e.success=function(){return t.resolve.apply(t,arguments)},t.abort=function(e){l.__xhr.abort(e)},l.__xhr=s.ajax(e),l._deferred=t,l.deferred=l._deferred.promise(),l._deferred.then(F,_),l)}function n(e,t){return e.beforeSend=function(e){e.setRequestHeader("Authorization",t)},e.authToken=t,t}function o(){var t={};if((h=s.insureSlash(h)+(e.action||r.ecs.constants.actions.ExecuteXQL)).indexOf(v)>-1&&(h=s.getUrlWithProtocol(h)),u.sponline&&h.indexOf(r.ecs.defaultConfig.connection.ecs.url)>-1)return t.error=r.ecs.strings.errors.urlNotProvided,t;if(b){var o="?";for(var i in b){var c=b[i];c&&(o+=encodeURIComponent(i)+"="+encodeURIComponent(c)+"&")}"&"===o.slice(-1)&&(o=o.slice(0,-1)),h+=o}if(a={url:h,type:m,data:e.rawData||s.stringify(C),dataType:g,contentType:S},y){var l;if(!0===y||"true"===y)if(e.authorization)l=e.authorization;else{if(!e.username||!e.password)return t.error="Basic Authorization requires username and password",t;l=btoa(e.username+":"+e.password)}l&&n(a,l)}else if(x){var d=s.getEcsAuthorization(x);n(a,d),a.authToken=d}return j&&(a.timeout=j),e.ajax&&s._extend(a,e.ajax),a}e||this.enull("parameters");var i={};try{i=this.session.connection.ecs}catch(e){}var a,s=this,l=f(),d=c.empty,p=this._extendSkipEmptyStrings({},this.config.connection.ecs,i,e.connection&&e.connection.ecs),h=e.url||p.url||d,g="json",m="POST",S=this.constants.http.contentTypeJson,v="servicebus.windows.net",y=e.authenticate||p.authenticate,x=e.coreApiKey||p.coreApiKey,b=e.urlParameters,w=e._requiresInstanceAsUrlParameter,E=e.useSharepointSettings||p.useSharepointSettings,C=e.data,j=r.ecs.getTimeout(),F=function(){return l.resolve.apply(l,arguments)},_=function(e){return clearTimeout(T),l.reject.apply(l,arguments),e};if(p&&p.core&&this._extend(a,{async:!0}),!(E&&r.sp&&window.SP))return t();var T;return l._deferred=r.sp.getEcsProperties(),l._deferred.then(function(e){return e.apikey&&(x=e.apikey),e.url&&(h=e.url),e.instance&&(w?(b||(b={}),b.applicationName=e.instance):C.applicationName=e.instance),t()},_),l.deferred=l._deferred.promise(),l},p.executeRequest=function(e){var t=this,n=f(),o=this._extend({},e),i=function(o){t.trace(t.format(t.constants.messages.xhrDone,e.action||"generic"));var i=t.getEcsError(o);if(i)return e.silent&&t.error(t.format(t.constants.messages.ecsFail+".silent %o",e.action||"generic"),o),n.reject(i,o),i;var a=r.ecs.unwrapResult(o);return n.resolve(a,o),a},a=function(o,i,a){var c;return"string"==typeof o?c=o:(c={xhr:o,textStatus:i,errorThrown:a},"notmodified"===i&&t.warn(i),c.message=r.ecs.getShortErrorMessage(c)),t.error("xhr.%s.fail: %o",e.action||"generic",c),n.reject(c),c};return n._deferred=this.executeAjaxRequest(o),n._deferred.then(i,a),n.deferred=n._deferred.promise(),n},p.executeEcsCommand=function(e,t){var n=this,o=this._extend({},e,{data:{}}),i=t||e.action,a=this.constants.actions,s=f(),u=function(t){n.trace(n.format("ecs.{0}.done",i));var r;return r=o.withMetadata?t:t&&t.rows||t,r=n.preprocessResult(e.preprocessResult,r),s.resolve(r,t),e&&(e.done||e.success)&&s.done(e.done||e.success),r},l=u,d=function(t){return n.error(n.format("ecs.{0}.fail: %o",i),t),n.lastError=t,s.reject(t),e&&(e.fail||e.error)&&s.fail(e.fail||e.error),t},p=d;e.action||(o.action=t),e.syncObject||(e.syncObject={});var h=function(t){var r=function(e){var t;try{t=e.connection.ecs.serviceApplication||e.connection.ecs.instance}catch(e){}return t},i=r(e)||r(n.session)||r(n.config);return i?(o.data.applicationName=i,t&&(o.urlParameters||(o.urlParameters={}),o.urlParameters.applicationName=i)):t&&(o._requiresInstanceAsUrlParameter=!0),o},g=function(){var t=e.syncObject&&e.syncObject.scope||e.scope;return t&&(o.data.connectionScope=t),o},m=function(e){return h(e),g()},S=function(){e.data?o.data=e.data:n._extend(o.data,{SecureStoreName:e.SecureStoreName,UserOrGroup:e.UserOrGroup,Username:e.Username,Password:e.Password})},v=function(e,t){u=function(t){return l(t),n.trace(e+c.space+"%o",t),t},d=function(e){return p(e),n.warn(t+c.space+"%o",e),e}};switch(i){case a.BeginConnectionScope:u=function(t){if(l(t),!t.id){var r=n.strings.warnings.scopeWithoutID;return n.warn(r),p(r)}return e.syncObject.scope=t,t},h(!0),0===Object.keys(o.data).length&&(o.data=c.empty);break;case a.CreateFunction:if(!o.data.name){var y=e.name||e.func;if(!y)return n.warn(n.strings.errors.parametersName),s.reject(n.strings.errors.parametersName);o.data.name=y}m();break;case a.EndConnectionScope:if(m(),!o.data.connectionScope){var x=n.strings.warnings.scopeNotDefined;return n.warn(x),s.reject(x)}u=function(e){return e===n.constants.responses.EndConnectionScopeOk?l(e):s.reject(e),e};break;case a.ExecuteFunction:e.data&&e.data.function&&e.data.function.name?o.data=e.data:o.data={function:e.sapFunctionObject||e.data},m();break;case a.ExecuteXQL:var b=e.data&&e.data.query||"string"==typeof e.data&&e.data||"string"==typeof e.query&&e.query;if("string"!=typeof b)return n.warn(n.strings.warnings.xqlNotString),s.reject(n.strings.warnings.xqlNotString);o.data.query=b,m();break;case a.TestConnection:v(n.strings.info.ecsConnectionTested,n.strings.errors.ecsConnectionTestFailed),h(!0);break;case a.TestSAPConnection:v(n.strings.info.ecsSapConnectionTested,n.strings.errors.ecsSapConnectionTestFail),h(!0);break;case a.AddCredentialToSecureStore:S(),v(n.strings.info.credentialAdded,n.strings.info.credentialFail);break;case a.DeleteCredentialFromSecureStore:S(),v(n.strings.info.credentialDeleted,n.strings.info.credentialFail);break;case a.CheckCredentialInSecureStore:S(),v(n.strings.info.credentialChecked,n.strings.info.credentialFail),u=function(e){l(t);var t,r="TRUE"===e;return t=r?n.strings.info.credentialChecked:r||"FALSE"!==e?"UNKNOWN":n.strings.info.credentialCheckedFail,n.trace(t+c.space+e),e};break;case a.Version:case a.Notifications:case a.Services:case a.ClearCaches:case a.ServiceBusConnectIfAutoRegisterIsEnabled:case a.ServiceBusDisconnect:return this.warn("ecs command not implemented."),s.reject("ecs command not implemented.");default:return this.warn("ecs command not defined."),s.reject("ecs command not defined.")}return s._deferred=r.ecs.executeRequest(o),s.deferred=s._deferred.promise(),s._deferred.then(u,d),s};var h={executeXql:n.ExecuteXQL,createSapFunction:n.CreateFunction,executeSapFunction:n.ExecuteFunction,beginConnectionScope:n.BeginConnectionScope,endConnectionScope:n.EndConnectionScope,testConnection:n.TestConnection,testSapConnection:n.TestSAPConnection,AddCredentialToSecureStore:n.AddCredentialToSecureStore,DeleteCredentialFromSecureStore:n.DeleteCredentialFromSecureStore,CheckCredentialInSecureStore:n.CheckCredentialInSecureStore};for(var g in h)p[g]=function(e){return function(t){return this.executeEcsCommand(t,e)}}(h[g]);return p.executeFunction=p.createAndExecuteSapFunction=function(e){var t=this,n=this._extend({},e),o=f(),i=function(){return o.reject.apply(this,arguments)},a=function(a){var c=e.data,s=c instanceof Function?0===c.length?r.ecs.assignFunctionParameters(c(),a):c(a):r.ecs.assignFunctionParameters(c,a),u=t._extend({},n);return u.data=s,o._deferred=t.executeSapFunction(u),o.deferred=o._deferred.promise(),o._deferred.then(function(){return o.resolve.apply(this,arguments)},i),o};return n.name||this.warn('sap function name not supplied (or legacy "func" usage).'),o._deferred=this.createSapFunction(n),o.deferred=o._deferred.promise(),o._deferred.then(a,i),o.then(function(t){return e.done&&e.done(t),t},function(t){return e.fail&&e.fail(t),t}),o.always(function(t){return e.always&&e.always(t),t}),o},p.executeChain=function(e){if(e.inScope)return delete e.inScope,this.executeInScope(e);var t=this,n=0,o=e.syncObject||(e.syncObject={}),i=this._extend({},e),a=f(),c=function(n){t.trace(t.format(t.constants.messages.tecsDone,t.constants.actions.ExecuteInScope)),e.done&&e.done(n)},s=function(n){t.trace(t.format(t.constants.messages.tecsFail,t.constants.actions.ExecuteInScope)),e.fail&&e.fail(n)},u=i.functions,l=function(t){return e.always&&e.always(t),delete o.cache,t},d=function(i){if(o.abort)return l(i),i;if(!u)return t.warn(t.strings.warnings.chainNoQueue),c&&c(i),a.resolve(t.strings.warnings.chainNoQueue),l(i),i;var f=u.shift();if(!f)return c&&c(i),a.resolve(i),l(i),i;var p=r.ecs._extend({connection:r.ecs._extend({},e.connection,f.connection)},f,{scope:o.scope}),h=function(e){if(f.done&&f.done(e),f.deferred&&f.deferred.resolve(e),f.name){var t=f.name||f.func,r=o.cache,i=n++;r[i]=e,r[i]._name=t}return d(e)},g=function(e){return f.fail&&f.fail(e),f.deferred&&f.deferred.reject(e),s&&s(e),l(e),e};return t.trace(f),f.query?(f.data||(f.data=f.query),a._deferred=t.executeXql(p)):a._deferred=t.createAndExecuteSapFunction(p),a.deferred=a._deferred.promise(),a._deferred.then(h,g),a};return i.syncObject=o,o.cache={},e.commit&&(u.slice(-1)[0].action===t.constants.actions.EndConnectionScope?u.splice(u.length-1,0,this.getCommitFunction()):u.push(this.getCommitFunction())),d(),a},p.executeInScope=function(e){if(e.syncObject&&e.syncObject.scope&&!e.newScope)return this.executeChain(e);var t=this,n=f(),r=e.syncObject||(e.syncObject={}),o=this._extend({},e),i={connection:o.connection,syncObject:r},a=function(e){return n.reject(e),e};return o.syncObject=r,n._deferred=this.beginConnectionScope(i),n.deferred=n._deferred.promise(),n._deferred.then(function(e){n._deferred=t.executeChain(o),n._deferred.always(function(){return t.endConnectionScope(i)}),n.deferred=n._deferred.promise(),n._deferred.then(function(e){return n.resolve(e),e},a)},a),n},p.getCommitFunction=function(e){var t=this,n=f(),r={name:this.constants.sap.functions.BapiTransactionCommit,_deferred:n};return r.deferred=n.promise(),n.then(function(e){return t.trace(t.format(t.constants.messages.ecsDone,"commit")),e},function(e){return t.error(t.format(t.constants.messages.sapFail,"commit")),e}),r},p.preprocessResult=function(e,t){var n=t;if(e)if(e instanceof Function)n=e(n);else for(var r in e)n=e[r](n);return n},p.assignFunctionParameters=function(e,t){function n(e,t){for(var r in e){var o=t[r],i=e[r];o&&(e[r]="object"==typeof o?n(i,o):o)}return e}var r=this;if(t||this.enull("metadata:sapFunctionObject"),!e)return t;var o=e.exports,i=e.tables,a=e.imports,c=e.changings,s=t.exports,u=t.tables,l=[o,a,c],d=[s,t.imports,t.changings];for(var f in l){var p=l[f],h=d[f];for(var g in p){var m=p[g],S=h[g];if(!S)return void r.warn("Invalid parameter will be skipped: "+g);var v=S.paramValue.values;v?n(v,m):S.paramValue=m}}for(var y in i)Array.prototype.push.apply(u[y].rows,i[y]);return t},p.unwrapResult=function(e){return e.result||e.Result||e.success||e.Success},p.getConnection=function(e){return this._extend({},r.ecs.config.connection,e)},p.getXhrError=function(e,t){if(!e)return c.empty;t||(t={});var n=this,r=t.html?c.htmlLineBreak:String.fromCharCode(13),o=new RegExp(String.fromCharCode(13),"g"),i=e.error||e,a=i&&i.xhr,s=i&&i.textStatus,u=n.strings.errors[s],l=c.empty;if(a){if(u)l=u;else if(t.long){var d=i.errorThrown;l="XHR status: "+a.status+r+"textStatus: "+i.textStatus,d&&"string"==typeof d&&(l+=r+"errorThrown: "+t.html?d.replace(o,c.htmlLineBreak):d+r)}t&&t.wrap&&(l=n.getWrapString(n.strings.errors.connectionOrRequest,t)+l)}return l},p.getEcsError=function(e,t){if(!e)return c.empty;t||(t={});var n=new RegExp(this.format("{0}|{1}|{2}|{3}",String.fromCharCode(13),c.literalNewLineReturn,c.literalLineBreak,"\\\\r\\\\n"),"g"),r=e.error||e.Error||e,o=r.message||r.Message||c.empty;return t.long&&r.stackTrace&&(o=this.stringify(r)),o&&t.html&&(o=o.replace(n,c.htmlLineBreak)),o&&t.wrap&&(o=this.getWrapString(this.strings.ecsError,t)+o),o},p.getShortErrorMessage=function(e,t){if("string"==typeof e)return e;var n=e&&e.error||e;return"string"==typeof n?n:this.getEcsError(n,t)||this.getXhrError(n,t)||n&&n.title||this.strings.errors.genericErrorTitle},p.getLongErrorMessage=function(e,t){if(!e)return c.empty;var n=e.error||e,r=t?c.htmlLineBreak:String.fromCharCode(13),o={html:t,long:!0,wrap:!0},i=this.getEcsError(n,o),a=this.getXhrError(n,o);return this.format("{0}{1}",i?i+r:c.empty,a)},p.getFullMessage=function(e,t){return r.ecs.getLongErrorMessage(e,t)},p.getLastError=function(){return this.lastError},p.popup=function(){if(r.core&&r.core.popup)return r.core.popup.apply(r.core,arguments);alert("string"!=typeof arguments[0]||arguments[1]?this.stringify(arguments):arguments[0])},p.isAborted=function(e){return"abort"===e.textStatus},p.dateToString=function(e){return e.getFullYear?s+e.getFullYear()+(c.charZero+(e.getMonth()+1)).slice(-2)+(c.charZero+e.getDate()).slice(-2):(this.warn("not a date %o",e),e)},p.stringToDate=p.parseSapDate=function(e){return"string"!=typeof e?e:new Date(e.substr(0,4),parseInt(e.substr(4,2))-1,e.substr(6,2))},p.isSharepointOnline=function(){return window.location.host.indexOf("sharepoint.com")>-1},p.useSharepointSettings=function(e){return this.config.connection.ecs.useSharepointSettings=!0,e&&this.saveConfig(!1,!0),this.config.connection.ecs.useSharepointSettings},p.askSettingsAndSaveToSharepoint=function(e,t){return r.sp?r.sp.askSettingsAndSaveToSharepoint(e,t):this.warn("tEcs not supported, use theobald.ecs.js")},p.setSharepointSettings=function(){return r.sp?r.sp.setSharepointSettings.apply(r.sp,arguments):this.warn("please use full theobald.ecs library!")},p.callSoapService=p.wsdSoapQuery=function(e){e||this.enull("options");var t=this,n=f(),r=e.namespace&&this.insureSlash(e.namespace)||"http://www.theobald-software.com/ERPConnectServices/WebServices/",o=e.url||this.format("/_vti_bin/{0}.svc",e.serviceName),i=e.interfaceName||"I"+e.serviceName,a=e.actionName||e.action||"GetServiceInfo",s=function(e){if(!e)return"";var n=c.empty;for(var r in e){var o=e[r],i=typeof o;if(o.indexOf("'")>-1&&t.warn("Soap Parameter has quote-sign."),"object"===i)n+=t.format("<web:{0}>{1}</web:{0}>",r,s(o));else if("array"===i)for(var a in o)n+=t.format("<web:{0}>{1}</web:{0}>",r,o[a]);else n+=t.format("<web:{0}>{1}</web:{0}>",r,o)}return n},u=function(){t.log("Service OK"),n.resolve.apply(n,arguments)},l=function(e,r,o){t.error("Service ERROR: %s, %o",r,o),n.reject.apply(n,arguments)},d={contentType:"text/xml; charset=utf-8",headers:{SOAPAction:r+this.insureSlash(i)+a},type:"POST",url:o};if(d.data=this.format('<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:web="http://www.theobald-software.com/ERPConnectServices/WebServices"><soapenv:Header/><soapenv:Body><web:{0}>{1}</web:{0}></soapenv:Body></soapenv:Envelope>',a,s(e.data)),e.ajax){var p=e.ajax;this._extend(d,p),(p.done||p.success)&&n.done(p.done||p.success),(p.fail||p.error)&&n.fail(p.fail||p.error)}return d.done=u,d.fail=l,n.__xhr=t.ajax(d),(e.done||e.success)&&n.done(e.done||e.success),(e.fail||e.error)&&n.fail(e.fail||e.error),e.always&&n.always(e.always),n},p.getSapLogonLanguage=function(e){return this.executeFunction(this._extend({name:this.constants.sap.functions.CrystalGetLogonLanguage},e))},p.initializeLiveCombobox=function(e){var t=t||theobald.$||e.$;if(e)if(e.controls)if(t){var n=this._extendSkipEmptyStrings({},{useUppercaseValuesForQueries:!0,removeLeadingZerosFromNumbers:!1},e.searchOptions),r=e.controls,o=e.tableSettings,i=t("#"+r.inputId),a=t("#"+r.selectId),c=t("#"+r.outputId),s=t("#"+r.descriptionId),u=(t("#"+r.buttonId),{loading:"Loading...",matches:" matches",noMatchText:"No direct match!",noMatches:"No matches",errComm:"Communication error, please see console",select:"Please select",type:"Start typing in the input above"}),l={loading:"Wird geladen...",matches:" Treffer",noMatchText:"Keine direkte Entsprechung!",noMatches:"Keine Treffer",errComm:"Netzwerk Fehler (bitte Konsole öffnen)",select:"Bitte auswählen",type:"Geben Sie einen Suchbegriff ein"},d=this._extendSkipEmptyStrings({},n.german&&l||u,d),f=n.xql||tEcs.format(n.xqlFormat||"SELECT TOP 10 {0}, {1} FROM {2} WHERE ({0} LIKE '%{{0}}' OR {1} LIKE '%{{0}}%') AND SPRAS = '{3}' ",o.idField,o.textField,o.tableName,o.language),p=function(t){var r=n.useUppercaseValuesForQueries?t.toUpperCase():t,o={data:tEcs.format(f,r)};return e.connection&&(o.connection=e.connection),window.ecsCoreConnection&&(o.connection=window.ecsCoreConnection),tEcs.executeXql(o)},h=a.find("option:nth-child(1)").clone();a[0].selectedIndex=-1,a.empty(),a.append(h.clone()),i.on("input",function(){a.empty();var e=h.clone();e.text(d.loading),a.append(e),e.prop("selected","selected"),p(i.val()).done(function(e){a.empty();var r=h.clone();r.prop("selected","selected"),e.length>0?(r.text(tEcs.format("{0} ({1})",d.select,e.length+d.matches)),a.append(r),t.each(e,function(e,t){var r=h.clone(),i=n.removeLeadingZerosFromNumbers?tEcs.util.ltrim(t[o.idField],"0"):t[o.idField];r.text(tEcs.format("{0} ({1})",i,t[o.textField])),r.attr("tsid",t[o.idField]),r.attr("tsdescription",t[o.textField]),a.append(r)})):(r.text(d.noMatches),a.append(r)),a[0].selectedIndex=0}).fail(function(e,t){console.log(e,t)})}),a.on("change",function(){var e=a.find("option:selected");c.val(e.attr("tsid")),s.val(e.attr("tsdescription"))})}else console.error("ECSJS: Please set the jQuery instance for using LiveCombobox. (options: {$ = NWA$})");else console.error("ECSJS: controls not defined. Please use initializeLiveCombobox({controls: {xx}})");else console.error("ECSJS: options must be defined (table and ui-controls information)")},r.ecs=new r[i],p.isSharepointOnline()&&(u.sponline=!0),p.initialize=function(){r.ecs.config=r.ecs.defaultConfig,r.ecs.strings=r.ecs.localizableStrings.en;var e=function(){var e=arguments[0],t=r.ecs.className+c.colonSpace;r.ecs.extendedLogger&&r.ecs.extendedLogger(arguments),"string"==typeof e&&(e=t+e),console.log.apply(console,arguments)};r.ecs._extend(r.ecs,{trace:d.noop,debug:e,info:e,warn:e,error:e,enull:function(t){e("undefinedParameter: "+t)},_activateTraces:function(){r.ecs.trace=r.ecs.info}}),o.Ecs.resolve()},window.tEcs=r.ecs,"theobald.ecs.micro"===r.moduleName?p.initialize():(o.Core||(o.Core=r.newDeferred()),o.Core.done(function(){r.core.initModule(r[a],function(){u.sponline&&!r.ecs.config.connection.ecs.core&&(r.ecs.config.connection.ecs.core=!0,r.ecs.saveConfig(!1,!0),r.core.getDeferred("Log").done(function(){r.ecs.info(r.ecs.strings.info.ecscoreMode)}))})})),r[a]}),n("theobald.ecs.micro.js",function(){}),t(["theobald.ecs"])}();